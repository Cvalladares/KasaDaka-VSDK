<?xml version="1.0" encoding="UTF-8"?>
<vxml version="2.1">
	<!-- These are global variables that stores the user's buying choices-->
	<var name="auction_id" expr = "{{auction_id}}"/>
	<!-- This is a global Variable that stores the user's phone info-->
	<var name="owner" expr="session"/>
	<!-- This is a global Variable that stores the user's selling options-->
	<var name="product"/>


	<!-- Fetch the information from the session and store it in a variable-->
	<script>
		owner = session.connection.remote.uri
	</script>
	<!-- This is the initial menu that lets the user decide whether you want
			to buy or sell-->
  <menu id="menu1" dtmf="true">
   <prompt>
		<audio src="http://django-static.vps.abaart.nl/group10/django/Greeting.wav"/>
		<audio src="http://django-static.vps.abaart.nl/group10/django/pre_choice_option_en.wav"/>
		<audio src="http://django-static.vps.abaart.nl/group10/django/Buy_xXdG957.wav"/>
		<audio src="http://django-static.vps.abaart.nl/group10/django/post_choice_option_en.wav"/>
		<audio src="http://django-static.vps.abaart.nl/group10/django/1_en.wav"/>
		<audio src="http://django-static.vps.abaart.nl/group10/django/pre_choice_option_en.wav"/>
		<audio src="http://django-static.vps.abaart.nl/group10/django/Sell.wav"/>
		<audio src="http://django-static.vps.abaart.nl/group10/django/post_choice_option_en.wav"/>
		<audio src="http://django-static.vps.abaart.nl/group10/django/2_en.wav"/>
   </prompt>
   <choice next = "#buyform"/>
   <choice next = "#sellform"/>
  </menu>
 
	<!-- This is the initial form specifying how many goods are left to buy and prompts
		  how many goods you want to buy-->
  <form id="buyform">
	  <field name = "quantity" type="digits?minlength=1;maxlength=2">
			<!-- This is an open ended grammar to let the user specify how many items to buy
				  Currently it is limited to up to 9 items and allows 0 as an input-->
			<prompt>
				<!-- You chose to buy. At the moment we have a total of.. -->
				<audio src="http://django-static.vps.abaart.nl/group10/django/YouChoseToBuy.wav"/>
				<!-- NUMBER-->
				<audio src="{{ quantity_for_sale }}"/>
                <!--Item for sale-->
                <audio src="{{ item_on_schedule }}"/>
			    <!--How many jars would you like to buy-->
                <audio src="http://django-static.vps.abaart.nl/group10/django/HowManyJars.wav"/>
			</prompt>		
			
            <noinput>
                <reprompt/>
            </noinput>
            <nomatch>
              <reprompt/>
            </nomatch>

	  </field>
	  
	  <!-- Repeat the user choice and transfer the user to the following form (asking for bid)-->
	  <filled>          
        <!-- TODO: Create Feedback "You chose to buy N items" -->
		<goto next="#makeNewBid"/>
      </filled>  
  </form>

	<!-- Request the User to input how much to pay for the ammount of goods selected -->
    <form id="makeNewBid">
		<!-- This grammar is limited from 0 to 9 -->
	  <field name = "bid" type="digits?minlength=1;maxlength=2">

			<prompt>
				<!--How Much would you like to pay for these items? -->
				<audio src="http://django-static.vps.abaart.nl/group10/django/HowMuchWouldYouLikeToPay.wav"/>
			</prompt>		
			
            <noinput>
				<reprompt/>
            </noinput>
            <nomatch>
				<reprompt/>
            </nomatch>
	  </field>
			
	<!--Confirm the User's choice and instruct them about further steps-->	
	  <filled>          

		<!-- TODO: "You have chosen to pay X Zedi" -->
		<!-- TODO: "Paying at least the base ammount"-->
		<prompt>
			<!--We will call you to let you know if you have won this bid or
			if somebody is paying more than you. Goodbye-->
			<audio src="http://django-static.vps.abaart.nl/group10/django/WeWillCallYouBID.wav"/>


		</prompt>
		
      </filled>  
		<!-- TODO: "Submit the BID values entered as a post" -->
		<block>
     		 <submit next="" enctype="multipart/form-data" method="post" namelist="owner quantity bid auction_id"/>
   		</block>

  </form>
  
  <!-- This form has to do with selling-->
  <form id="sellform">
		<!-- This grammar uses dtmf and has 3 different choices only-->	
		  <field name = "itemtosell">
			<!-- TODO: Make dynamic database query for the items -->
			<grammar xml:lang="en-US" root = "openDigitInput" mode="dtmf">
			  <rule id="openDigitInput" scope="public" >
					  <one-of>                      
						<!-- Grammar will be generated to contain only up to the number of
							 quieried form the database -->
						{{item_indexes}}
					  </one-of>                     
			  </rule>           
			</grammar>    
			
			<prompt>
				<!--You have chosen to sell-->
				<audio src="http://django-static.vps.abaart.nl/group10/django/YouHaveChosenToSell.wav"/>
				<!--What are you Trying to sell? Press 1 for shea nuts, press 2 for shea butter, or press 3 for honey-->
				<audio src="http://django-static.vps.abaart.nl/group10/django/WhatAreYouTryingToSell.wav"/>

			</prompt>					
			
            <nomatch>
				<reprompt/>
            </nomatch>
		</field>
		
	  <filled>   
	  <!-- This section stores the user's item choice in a global variable to be 
	  used in the final section-->
		{{product_conditionals}}
		
		<goto next="#saleQuantity"/>	
		
      </filled>  
  </form>
  
  <!-- Ask the user the quantity of items to sell-->
  <form id="saleQuantity">
  		<field name = "quantity" type="digits?minlength=1;maxlength=2">

		<prompt>
			<!-- How many? -->
			<audio src="http://django-static.vps.abaart.nl/group10/django/HowMany.wav"/>
		</prompt>

		<noinput>
			<reprompt/>
		</noinput>
		<nomatch>
			<reprompt/>
		</nomatch>
		</field>
		
		<filled>
			<goto next="#minPrice"/>
		</filled>
  </form>

  <form id="minPrice">
	  <field name = "starting_price" type="digits?minlength=1;maxlength=3">
			<prompt>
				<!-- How many? -->
				<audio src="http://django-static.vps.abaart.nl/group10/django/minimum_price.wav"/>
			</prompt>
	  </field>

	    <noinput>
			<reprompt/>
		</noinput>
		<nomatch>
			<reprompt/>
		</nomatch>

		<filled>
			<prompt>
				<audio src="http://django-static.vps.abaart.nl/group10/django/WeWillCallYouSELL.wav"/>
			</prompt>
		</filled>

	  	<!--TODO: submit values sto the create auction endpoint-->
		<block>
     		 <submit next="" enctype="multipart/form-data" method="post" namelist="owner quantity product starting_price"/>
   		</block>

  </form>

  <form id="hangupBid">
		
  </form>
  
</vxml>